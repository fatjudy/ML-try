---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.4.1
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python}
import pandas as pd
import numpy as np
```

# Data Wrangling: Join, Combine, and Reshape


## 8.1 Hierarchical Indexing

```{python}
# Useful for data with multiple index levels on an axis.
data = pd.Series(np.random.randn(9),
...: index=[['a', 'a', 'a', 'b', 'b', 'c', 'c', 'd', 'd'],
...: [1, 2, 3, 1, 3, 1, 2, 2, 3]])
```

```{python}
data
```

```{python}
data.index
```

```{python}
data['b']
```

```{python}
data['b':'c']
```

```{python}
data.loc[:,2]
```

```{python}
data.unstack()
```

```{python}
data.unstack().stack()
```

```{python}
frame = pd.DataFrame(np.arange(12).reshape((4, 3)),
....: index=[['a', 'a', 'b', 'b'], [1, 2, 1, 2]],
....: columns=[['Ohio', 'Ohio', 'Colorado'],
....: ['Green', 'Red', 'Green']])
```

```{python}
frame
```

```{python}
frame.index.names = ['key1', 'key2']
```

```{python}
frame.columns.names = ['state', 'color']
```

```{python}
frame
```

```{python}
frame['Ohio']
```

```{python}
# Why error
MultiIndex.from_arrays([['Ohio', 'Ohio', 'Colorado'], ['Green', 'Red', 'Green']], names=['state', 'color'])
```

### Reordering and Sorting levels

```{python}
frame.swaplevel('key1', 'key2')
```

```{python}
frame.sort_index(level = 0)
```

```{python}
frame.swaplevel(0,1).sort_index(level = 0)
```

### Summary Statistics by Level

```{python}
frame.sum(level = 'key2')
```

```{python}
frame.sum(level = 'color', axis = 1)
```

### Indexing with a DataFrameâ€™s columns

```{python}
frame = pd.DataFrame({'a': range(7), 'b': range(7, 0, -1),
....: 'c': ['one', 'one', 'one', 'two', 'two',
....: 'two', 'two'],
....: 'd': [0, 1, 2, 0, 1, 2, 3]})
```

```{python}
frame
```

```{python}
frame_1 = frame.set_index(['c', 'd'])
```

```{python}
frame_1
```

```{python}
frame.set_index(['c', 'd'], drop = False)
```

```{python}
frame_1.reset_index()
```

## 8.2 Combining and Merging Datasets

```{python}
f1 = pd.DataFrame({'key': ['b', 'b', 'a', 'c', 'a', 'a', 'b'],
....: 'data1': range(7)})
```

```{python}
f1
```

```{python}
f2 = pd.DataFrame({'key': ['a', 'b', 'd'],
....: 'data2': range(3)})
```

```{python}
f2
```

```{python}
pd.merge(f1,f2)
```

```{python}
pd.merge(f1, f2, on = 'key')
```

```{python}
df3 = pd.DataFrame({'lkey': ['b', 'b', 'a', 'c', 'a', 'a', 'b'],
....: 'data1': range(7)})
```

```{python}
df3
```

```{python}
df4 = pd.DataFrame({'rkey': ['a', 'b', 'd'],
....: 'data2': range(3)})
```

```{python}
df4
```

```{python}
pd.merge(df3, df4, left_on='lkey', right_on='rkey')
```

```{python}
pd.merge(f1, f2, how = 'outer')
```

```{python}
f1
```

```{python}
f2
```

```{python}
pd.merge(f1, f2, on = 'key', how = 'left')
```

```{python}
pd.merge(f1, f2, how = 'inner')
```

```{python}
left = pd.DataFrame({'key1': ['foo', 'foo', 'bar'],
....: 'key2': ['one', 'two', 'one'],
....: 'lval': [1, 2, 3]})
```

```{python}
right = pd.DataFrame({'key1': ['foo', 'foo', 'bar', 'bar'],
....: 'key2': ['one', 'one', 'one', 'two'],
....: 'rval': [4, 5, 6, 7]})
```

```{python}
left
```

```{python}
right
```

```{python}
pd.merge(left, right, on = ['key1', 'key2'], how = 'outer')
```

```{python}
pd.merge(left, right, on = 'key1')
```

```{python}
pd.merge(left, right, on = 'key1', suffixes = ('_left', '_right'))
```

### Merging on Index

```{python}
left1 = pd.DataFrame({'key': ['a', 'b', 'a', 'a', 'b', 'c'],
....: 'value': range(6)})
```

```{python}
left1
```

```{python}
right1 = pd.DataFrame({'group_val': [3.5, 7]}, index=['a', 'b'])
```

```{python}
right1
```

```{python}
pd.merge(left1, right1, left_on = 'key', right_index=True) # Don't understand
```

```{python}

```
